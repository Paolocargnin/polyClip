var polyClip=new function(){var c=this,i,l=[];c.isIE=window.G_vmlCanvasManager;c.init=function(){(i=$("img[data-polyclip]"))||(i=$("img[data-polyclip]"));i.each(c.drawShape)};c.drawShape=function(b,d){var f=$(d),a=document.createElement("canvas");a.width=d.offsetWidth;a.height=d.offsetHeight;a.id="polyClip"+b;var g=jQuery.trim(f.attr("data-polyclip")).split(","),p=d.src;l[a.id]=[];f.replaceWith(a);c.isIE&&G_vmlCanvasManager.initElement(a);for(var e=a.getContext("2d"),f=0;f<g.length;f+=2){var h=parseInt(jQuery.trim(g[f])),
j=parseInt(jQuery.trim(g[f+1]));l[a.id].push({x:h,y:j});f==0?e.moveTo(h,j):e.lineTo(h,j)}if(c.isIE)e.fillStyle="rgb(0, 0, 0)",e.fill(),a=$("fill",a).get(0),a.color="none",a.src=i[b].src,a.type="tile",a.alignShape=false;else{var k=new Image;k.onload=function(){var a=e.createPattern(k,"repeat");e.fillStyle=a;e.fill()};k.src=p}};c.findObject=function(b){var d=b.currentTarget;if($(d).hasClass("cropParent"))return $(d);for(var f in l)if(l.hasOwnProperty(f)&&(d=$("#"+f),c.isInPolygon(d,b.pageX,b.pageY,
true)))return d};c.isInPolygon=function(b,d,f,a){var g=b.get(0),g=l[g.id],c=g.length,e,h,j,k,i,m,o=false,n={left:0,top:0};a&&(n=b.offset());if(c<3)return false;e=g[c-1].x+n.left;h=g[c-1].y+n.top;for(m=0;m<c;m++)b=g[m].x+n.left,a=g[m].y+n.top,b>e?(j=e,i=b,k=h,h=a):(j=b,i=e,k=a),b<d==d<=e&&(f-k)*(i-j)<(h-k)*(d-j)&&(o=!o),e=b,h=a;return o}};polyClip.isIE?$(window).bind("load",polyClip.init):$(document).ready(polyClip.init);
